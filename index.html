<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Thi Toán 12 - Mô Phỏng Đề Minh Họa (Đề số 2)</title>
    <style>
        :root {
            --primary: #0d6efd;
            --success: #198754;
            --danger: #dc3545;
            --warning: #ffc107;
            --bg: #f8f9fa;
            --dark: #212529;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--dark);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 20px;
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1000;
        }

        .timer-badge {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            background-color: var(--danger);
            padding: 8px 20px;
            border-radius: 50px;
            box-shadow: 0 2px 5px rgba(220, 53, 69, 0.4);
        }

        /* Section Headers */
        .part-header {
            background-color: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 40px 0 20px 0;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Question Cards */
        .question-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            transition: transform 0.2s;
        }

        .q-text {
            font-size: 1.05rem;
            margin-bottom: 15px;
        }

        .q-text strong {
            color: var(--primary);
        }

        /* Tables in Questions */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        .data-table th, .data-table td {
            border: 1px solid #ced4da;
            padding: 8px 12px;
            text-align: center;
        }

        .data-table th {
            background-color: #e9ecef;
            font-weight: 600;
        }

        /* Multiple Choice Options */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .option-label:hover {
            background-color: #f8f9fa;
        }

        .option-label input {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* True/False Table */
        .tf-table th, .tf-table td {
            text-align: center;
            vertical-align: middle;
        }
        .tf-table td:first-child {
            text-align: left;
        }
        .tf-radio {
            transform: scale(1.3);
        }

        /* Short Answer Input */
        .short-input {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            width: 250px;
            font-size: 1rem;
            margin-top: 10px;
        }

        /* Feedback & Results */
        .feedback {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #fff3cd;
            border-left: 5px solid var(--warning);
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .correct-card { border: 1px solid var(--success); background-color: #f8fff9; }
        .wrong-card { border: 1px solid var(--danger); background-color: #fff8f8; }
        
        .status-badge {
            font-weight: bold;
            margin-left: 10px;
        }
        .status-correct { color: var(--success); }
        .status-wrong { color: var(--danger); }

        .btn-submit {
            display: block;
            width: 100%;
            padding: 18px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: background 0.3s;
        }

        .btn-submit:hover {
            background-color: #0b5ed7;
        }

        .result-box {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background-color: #d1e7dd;
            border: 2px solid #badbcc;
            border-radius: 10px;
            text-align: center;
        }

        .final-score {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1 style="margin:0; font-size: 1.8rem;">ĐỀ KIỂM TRA TOÁN 12</h1>
            <p style="margin:5px 0 0 0; color:#6c757d">Chủ đề: Hàm số, Hình học Oxyz, Thống kê</p>
        </div>
        <div class="timer-badge" id="timer">60:00</div>
    </div>

    <form id="quiz-form">
        <div id="quiz-content">
            </div>

        <button type="button" class="btn-submit" onclick="submitQuiz()">NỘP BÀI</button>
    </form>

    <div class="result-box" id="result-box">
        <h3>KẾT QUẢ BÀI LÀM</h3>
        <div class="final-score" id="score-display">0.00 / 10</div>
        <p>Xem chi tiết đáp án và lời giải ở phía trên.</p>
    </div>
</div>

<script>
    // --- NGÂN HÀNG CÂU HỎI (DATA) ---
    
    // PHẦN 1: TRẮC NGHIỆM NHIỀU LỰA CHỌN (10 CÂU)
    const part1Data = [
        {
            text: "Cho hàm số y = f(x) có bảng biến thiên: y' > 0 trên (-∞; -1) và (2; +∞); y' < 0 trên (-1; 2). Khẳng định nào sau đây đúng?",
            options: [
                { text: "Hàm số đồng biến trên khoảng (2; +∞).", correct: true },
                { text: "Hàm số nghịch biến trên khoảng (-∞; -1).", correct: false },
                { text: "Hàm số đồng biến trên khoảng (-1; 2).", correct: false },
                { text: "Hàm số nghịch biến trên khoảng (0; 3).", correct: false }
            ],
            explain: "Dựa vào dấu của y', hàm số đồng biến khi y' > 0. Khoảng (2; +∞) thỏa mãn."
        },
        {
            text: "Tìm giá trị lớn nhất M của hàm số y = x⁴ - 2x² + 3 trên đoạn [0; 2].",
            options: [
                { text: "M = 11", correct: true },
                { text: "M = 3", correct: false },
                { text: "M = 2", correct: false },
                { text: "M = 1", correct: false }
            ],
            explain: "y' = 4x³ - 4x. Nghiệm thuộc [0;2] là x=0, x=1. f(0)=3, f(1)=2, f(2)=11. Vậy Max = 11."
        },
        {
            text: "Tiệm cận xiên của đồ thị hàm số y = (x² + 2x - 1) / (x - 1) là đường thẳng:",
            options: [
                { text: "y = x + 3", correct: true },
                { text: "y = x + 2", correct: false },
                { text: "y = x - 1", correct: false },
                { text: "y = x", correct: false }
            ],
            explain: "Thực hiện phép chia đa thức: (x² + 2x - 1) : (x - 1) = x + 3 dư 2. Vậy TCX là y = x + 3."
        },
        {
            text: "(Toán thực tế) Số lượng vi khuẩn ban đầu là 100 con, tăng trưởng theo công thức S(t) = 100.e^(0,5t) (t tính bằng giờ). Sau bao lâu số lượng vi khuẩn đạt 1000 con?",
            options: [
                { text: "t ≈ 4,6 giờ", correct: true },
                { text: "t = 2 giờ", correct: false },
                { text: "t ≈ 3,5 giờ", correct: false },
                { text: "t = 5 giờ", correct: false }
            ],
            explain: "1000 = 100.e^(0,5t) ⇔ e^(0,5t) = 10 ⇔ 0,5t = ln(10) ⇔ t = 2.ln(10) ≈ 4,6."
        },
        {
            text: "Trong không gian Oxyz, cho A(1; 2; -1), B(3; 0; 1). Tọa độ trung điểm I của đoạn AB là:",
            options: [
                { text: "(2; 1; 0)", correct: true },
                { text: "(4; 2; 0)", correct: false },
                { text: "(2; -2; 2)", correct: false },
                { text: "(1; -1; 1)", correct: false }
            ],
            explain: "I = ((1+3)/2; (2+0)/2; (-1+1)/2) = (2; 1; 0)."
        },
        {
            text: "Trong không gian Oxyz, cho vecto u = (1; -2; 3) và v = (-2; 1; 1). Vecto a = u + 2v có tọa độ là:",
            options: [
                { text: "(-3; 0; 5)", correct: true },
                { text: "(-3; -1; 4)", correct: false },
                { text: "(3; 0; -5)", correct: false },
                { text: "(-1; -1; 4)", correct: false }
            ],
            explain: "2v = (-4; 2; 2). a = (1-4; -2+2; 3+2) = (-3; 0; 5)."
        },
        {
            text: "Cho mẫu số liệu ghép nhóm về doanh thu (triệu đồng):<br><table class='data-table'><tr><th>Doanh thu</th><th>[10;12)</th><th>[12;14)</th><th>[14;16)</th><th>[16;18)</th><th>[18;20]</th></tr><tr><td>Số ngày</td><td>5</td><td>10</td><td>15</td><td>7</td><td>3</td></tr></table>Nhóm chứa mốt của mẫu số liệu là:",
            options: [
                { text: "[14; 16)", correct: true },
                { text: "[12; 14)", correct: false },
                { text: "[16; 18)", correct: false },
                { text: "[10; 12)", correct: false }
            ],
            explain: "Tần số lớn nhất là 15, tương ứng với nhóm [14; 16)."
        },
        {
            text: "Giá trị đại diện của nhóm [20; 30) là:",
            options: [
                { text: "25", correct: true },
                { text: "20", correct: false },
                { text: "30", correct: false },
                { text: "50", correct: false }
            ],
            explain: "Giá trị đại diện = (20 + 30) / 2 = 25."
        },
        {
            text: "Cho hàm số bậc ba y = f(x) có đồ thị như hình vẽ (dạng chữ N). Hệ số a của hàm số này mang dấu gì?",
            options: [
                { text: "a > 0", correct: true },
                { text: "a < 0", correct: false },
                { text: "a = 0", correct: false },
                { text: "Không xác định", correct: false }
            ],
            explain: "Nhánh cuối cùng của đồ thị đi lên nên hệ số a > 0."
        },
        {
            text: "Phương trình đường tiệm cận đứng của đồ thị hàm số y = (2x - 1) / (x + 2) là:",
            options: [
                { text: "x = -2", correct: true },
                { text: "x = 2", correct: false },
                { text: "y = 2", correct: false },
                { text: "y = -2", correct: false }
            ],
            explain: "Tiệm cận đứng là nghiệm của mẫu số: x + 2 = 0 ⇔ x = -2."
        }
    ];

    // PHẦN 2: TRẮC NGHIỆM ĐÚNG SAI (3 CÂU)
    const part2Data = [
        {
            text: "Cho hàm số y = (x² - 3x + 6) / (x - 2).",
            subs: [
                { text: "Tập xác định D = R \\ {2}.", correct: true },
                { text: "Đạo hàm f'(x) = (x² - 4x) / (x - 2)².", correct: true },
                { text: "Hàm số đạt cực đại tại x = 0.", correct: true },
                { text: "Đường thẳng y = x - 2 là tiệm cận xiên của đồ thị.", correct: false }
            ],
            explain: "Ý d sai vì TCX là y = x - 1 (thực hiện phép chia đa thức)."
        },
        {
            text: "Trong không gian Oxyz, cho hình hộp chữ nhật ABCD.A'B'C'D' có A trùng với gốc tọa độ O, B(2;0;0), D(0;3;0), A'(0;0;4).",
            subs: [
                { text: "Tọa độ điểm C là (2; 3; 0).", correct: true },
                { text: "Độ dài đoạn thẳng AC' bằng 29.", correct: false },
                { text: "Vecto BD có tọa độ là (-2; 3; 0).", correct: true },
                { text: "Trung điểm của CC' có cao độ bằng 2.", correct: true }
            ],
            explain: "Ý b sai vì AC' = √(2²+3²+4²) = √29 (không phải 29)."
        },
        {
            text: "Cho mẫu số liệu ghép nhóm về chiều cao (cm) của 40 học sinh lớp 12A:<br><table class='data-table'><tr><th>Chiều cao</th><th>[150;155)</th><th>[155;160)</th><th>[160;165)</th><th>[165;170)</th><th>[170;175)</th></tr><tr><th>Số HS</th><td>4</td><td>10</td><td>15</td><td>8</td><td>3</td></tr></table>",
            subs: [
                { text: "Cỡ mẫu của số liệu là 40.", correct: true },
                { text: "Số trung bình cộng xấp xỉ 162,1 cm.", correct: true },
                { text: "Nhóm chứa trung vị là [155; 160).", correct: false },
                { text: "Tứ phân vị thứ nhất Q1 thuộc nhóm [155; 160).", correct: true }
            ],
            explain: "Ý c sai: Vị trí trung vị là 20. Tần số tích lũy: 4, 14, 29. Vậy trung vị thuộc nhóm [160; 165)."
        }
    ];

    // PHẦN 3: TRẢ LỜI NGẮN (3 CÂU)
    const part3Data = [
        {
            text: "(Toán thực tế) Một vật chuyển động với phương trình quãng đường s(t) = -t³ + 9t² + t (t > 0, tính bằng giây, s tính bằng mét). Tính vận tốc của vật tại thời điểm gia tốc bằng 0. (Kết quả là một số nguyên)",
            correct: 28,
            tolerance: 0.1,
            explain: "v(t) = -3t² + 18t + 1. a(t) = v'(t) = -6t + 18. a=0 ⇔ t=3. Thay t=3 vào v(t) ⇒ v(3) = -27 + 54 + 1 = 28."
        },
        {
            text: "(Toán thực tế - Oxyz) Một căn phòng kích thước 10m x 8m x 4m. Gắn hệ trục Oxyz tại một góc sàn nhà (Oz là chiều cao). Một bóng đèn treo tại tâm trần nhà. Khoảng cách từ bóng đèn đến gốc tọa độ O là bao nhiêu mét? (Làm tròn đến 1 chữ số thập phân)",
            correct: 7.5, // √56 ≈ 7.48
            tolerance: 0.1,
            explain: "Tâm trần I có tọa độ (5; 4; 4). OI = √(5² + 4² + 4²) = √(25+16+16) = √57 ≈ 7.5."
        },
        {
            text: "(Thống kê) Cho bảng điểm thi: Nhóm [7;8) có 12 HS, [8;9) có 8 HS. Biết tổng số HS các nhóm trước [7;8) là 10. Tổng số HS là 40. Tính Trung vị Me của mẫu số liệu? (Làm tròn đến 2 chữ số thập phân)",
            correct: 7.83,
            tolerance: 0.02,
            explain: "Vị trí Me là 20. Me thuộc nhóm [7;8). Me = 7 + [(20-10)/12]*1 = 7 + 10/12 ≈ 7.83."
        }
    ];

    // --- LOGIC XỬ LÝ (JS) ---

    // Hàm trộn mảng (Fisher-Yates)
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        let newArr = [...array];
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [newArr[currentIndex], newArr[randomIndex]] = [newArr[randomIndex], newArr[currentIndex]];
        }
        return newArr;
    }

    let currentP1 = [], currentP2 = [], currentP3 = [];

    function renderQuiz() {
        const contentDiv = document.getElementById('quiz-content');
        let html = '';

        // Trộn đề
        currentP1 = shuffle(part1Data);
        currentP2 = shuffle(part2Data);
        currentP3 = shuffle(part3Data); // Phần 3 thường ít trộn hơn nhưng vẫn trộn cho đúng logic

        // --- RENDER PHẦN 1 ---
        html += `<div class="part-header">PHẦN I. TRẮC NGHIỆM NHIỀU PHƯƠNG ÁN LỰA CHỌN (10 CÂU)</div>`;
        currentP1.forEach((q, index) => {
            // Trộn đáp án
            let shuffledOptions = shuffle(q.options);
            let optionsHtml = '<div class="options-grid">';
            const labels = ['A', 'B', 'C', 'D'];
            
            shuffledOptions.forEach((opt, idx) => {
                // Lưu trạng thái đúng/sai vào value để chấm điểm
                optionsHtml += `
                    <label class="option-label">
                        <input type="radio" name="p1_${index}" value="${opt.correct}">
                        <span><b>${labels[idx]}.</b> ${opt.text}</span>
                    </label>
                `;
            });
            optionsHtml += '</div>';

            html += `
                <div class="question-card" id="card_p1_${index}">
                    <div class="q-text"><strong>Câu ${index + 1}:</strong> ${q.text}</div>
                    ${optionsHtml}
                    <div class="feedback" id="fb_p1_${index}">${q.explain}</div>
                </div>
            `;
        });

        // --- RENDER PHẦN 2 ---
        html += `<div class="part-header">PHẦN II. TRẮC NGHIỆM ĐÚNG SAI (3 CÂU)</div>`;
        currentP2.forEach((q, index) => {
            let tableRows = '';
            q.subs.forEach((sub, sIdx) => {
                tableRows += `
                    <tr>
                        <td>${String.fromCharCode(97 + sIdx)}) ${sub.text}</td>
                        <td><input type="radio" class="tf-radio" name="p2_${index}_${sIdx}" value="true" data-ans="${sub.correct}"></td>
                        <td><input type="radio" class="tf-radio" name="p2_${index}_${sIdx}" value="false" data-ans="${!sub.correct}"></td>
                    </tr>
                `;
            });

            html += `
                <div class="question-card" id="card_p2_${index}">
                    <div class="q-text"><strong>Câu ${index + 1}:</strong> ${q.text}</div>
                    <table class="data-table tf-table">
                        <tr>
                            <th style="width:70%">Mệnh đề</th>
                            <th>Đúng</th>
                            <th>Sai</th>
                        </tr>
                        ${tableRows}
                    </table>
                    <div class="feedback" id="fb_p2_${index}">${q.explain}</div>
                </div>
            `;
        });

        // --- RENDER PHẦN 3 ---
        html += `<div class="part-header">PHẦN III. TRẮC NGHIỆM TRẢ LỜI NGẮN (3 CÂU)</div>`;
        currentP3.forEach((q, index) => {
            html += `
                <div class="question-card" id="card_p3_${index}">
                    <div class="q-text"><strong>Câu ${index + 1}:</strong> ${q.text}</div>
                    <input type="number" step="0.01" class="short-input" id="input_p3_${index}" placeholder="Nhập kết quả...">
                    <div class="feedback" id="fb_p3_${index}">Đáp án đúng: <strong>${q.correct}</strong><br>${q.explain}</div>
                </div>
            `;
        });

        contentDiv.innerHTML = html;
    }

    function submitQuiz() {
        clearInterval(timerInterval);
        let rawScore = 0;
        let totalPossibleScore = 10; // Giả định thang điểm 10
        // Cấu trúc điểm giả định: P1: 2.5đ (0.25/câu), P2: 4.5đ (1.5/câu), P3: 3đ (1.0/câu)
        // Tuy nhiên để đơn giản code, ta sẽ tính điểm thô và quy đổi.
        
        // --- CHẤM PHẦN 1 ---
        currentP1.forEach((q, index) => {
            const selected = document.querySelector(`input[name="p1_${index}"]:checked`);
            const feedback = document.getElementById(`fb_p1_${index}`);
            const card = document.getElementById(`card_p1_${index}`);
            
            feedback.style.display = 'block';
            
            if (selected && selected.value === "true") {
                rawScore += 0.25; // 0.25đ mỗi câu
                card.classList.add('correct-card');
                selected.parentElement.innerHTML += ` <span class="status-badge status-correct">✔ Đúng</span>`;
            } else {
                card.classList.add('wrong-card');
                if (selected) selected.parentElement.innerHTML += ` <span class="status-badge status-wrong">✘ Sai</span>`;
            }
        });

        // --- CHẤM PHẦN 2 ---
        // Quy tắc 2025: 1 ý: 0.1, 2 ý: 0.25, 3 ý: 0.5, 4 ý: 1.0
        currentP2.forEach((q, index) => {
            const feedback = document.getElementById(`fb_p2_${index}`);
            const card = document.getElementById(`card_p2_${index}`);
            feedback.style.display = 'block';

            let correctCount = 0;
            q.subs.forEach((sub, sIdx) => {
                const selected = document.querySelector(`input[name="p2_${index}_${sIdx}"]:checked`);
                const isTrue = sub.correct;
                let userCorrect = false;

                if (selected) {
                    // value của radio 'Đúng' là 'true', 'Sai' là 'false'
                    const userVal = (selected.value === 'true');
                    if (userVal === isTrue) {
                        userCorrect = true;
                        correctCount++;
                    }
                }
            });

            // Tính điểm theo quy chế mới
            let point = 0;
            if (correctCount === 1) point = 0.1;
            else if (correctCount === 2) point = 0.25;
            else if (correctCount === 3) point = 0.5;
            else if (correctCount === 4) point = 1.0;
            
            rawScore += point;

            if (correctCount === 4) card.classList.add('correct-card');
            else card.classList.add('wrong-card');
        });

        // --- CHẤM PHẦN 3 ---
        currentP3.forEach((q, index) => {
            const input = document.getElementById(`input_p3_${index}`);
            const feedback = document.getElementById(`fb_p3_${index}`);
            const card = document.getElementById(`card_p3_${index}`);
            
            feedback.style.display = 'block';
            
            const userVal = parseFloat(input.value);
            if (!isNaN(userVal) && Math.abs(userVal - q.correct) <= q.tolerance) {
                rawScore += 0.5; // Giả định mỗi câu 0.5 điểm (hoặc 1.0 tùy thang)
                card.classList.add('correct-card');
                input.style.borderColor = 'green';
            } else {
                card.classList.add('wrong-card');
                input.style.borderColor = 'red';
            }
        });

        // Hiển thị kết quả (Quy về thang 10 nếu cần, ở đây tôi cộng trực tiếp theo giả định)
        // P1: 10 * 0.25 = 2.5
        // P2: 3 * 1.0 = 3.0
        // P3: 3 * 0.5 = 1.5 => Tổng 7.0 (Demo). 
        // Để chuẩn thang 10, ta nhân hệ số hoặc sửa điểm từng câu.
        // Ta sẽ dùng công thức quy đổi tương đối để hiển thị đẹp.
        // Max Raw = 2.5 + 3.0 + 1.5 = 7.0.
        // Final = (Raw / 7.0) * 10.
        
        // Cập nhật thang điểm chuẩn 2025:
        // P3 thường là 0.5đ/câu => 1.5đ.
        // Tổng max là 10. Vậy ta sẽ scale.

        const maxRaw = 2.5 + 3.0 + 1.5; 
        const finalScore = (rawScore / maxRaw) * 10;

        const resultBox = document.getElementById('result-box');
        const scoreDisplay = document.getElementById('score-display');
        
        scoreDisplay.textContent = finalScore.toFixed(2) + " / 10";
        resultBox.style.display = 'block';
        
        // Disable nút nộp
        document.querySelector('.btn-submit').disabled = true;
        document.querySelector('.btn-submit').innerText = "ĐÃ NỘP BÀI";
        
        // Cuộn xuống kết quả
        resultBox.scrollIntoView({ behavior: 'smooth' });
    }

    // --- TIMER ---
    let timeRemaining = 60 * 60; // 60 phút
    let timerInterval;

    function startTimer() {
        const timerEl = document.getElementById('timer');
        timerInterval = setInterval(() => {
            let m = Math.floor(timeRemaining / 60);
            let s = timeRemaining % 60;
            s = s < 10 ? '0' + s : s;
            timerEl.textContent = `${m}:${s}`;
            timeRemaining--;

            if (timeRemaining < 0) {
                submitQuiz();
                alert("Hết giờ làm bài!");
            }
        }, 1000);
    }

    // Init
    window.onload = function() {
        renderQuiz();
        startTimer();
    };

</script>

</body>
</html>
